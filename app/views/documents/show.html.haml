%center
  
  - md = Redcarpet::Markdown.new(Redcarpet::Render::HTML.new({hard_wrap: true}))
  
  %h1 Acronym list to paste
  =# Don't place comments in the textarea -- it screws up the whitespace
  %textarea{rows: @document.acronym_count, cols: 60}
    - @document.allowed_acronyms.sort.each do |ac|
      = find_and_preserve "#{ac.initialism}\t#{ac.meaning}&#x000A;"

  %h1 Options
  = form_for(@document) do |f|
    = render partial: 'options', locals: {f: f}
    %p= f.submit "Refresh"
  
  %h1 Context on each acronym
  %table
    %thead
      %tr
        %th Acronym
        %th Context
    %tbody
      - @document.allowed_acronyms.sort.each do |ac|
        %tr
          =# TODO: split before, acronym, after into 3 columns so things line up more nicely
          %td= ac.initialism
          - if ac.has_meaning?
            %td#strikethrough= ac.context( { css: true, search_link: true } ).html_safe
          - else
            %td= ac.context( { css: true, search_link: true } ).html_safe
  
  = link_to 'Upload another document', new_document_path

  =# This throws a really obscure error
  =# Completed 401 Unauthorized in 24ms (ActiveRecord: 0.5ms)
  =# link_to 'Download the original document', @document.file
